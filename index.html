<html>
  <head>
    <meta charset="utf-8" />
    <title>Welcome to ArtsCity</title>
    <link
      rel="icon"
      href="https://artscity.io/wp-content/uploads/2022/02/cropped-arts-city-logo-icon-city-192x192.png"
      sizes="192x192"
    />

    <meta name="description" content="360&deg; Image Gallery - A-Frame" />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-layout-component@5.3.0/dist/aframe-layout-component.min.js"></script>
    <script src="https://unpkg.com/aframe-template-component@3.2.1/dist/aframe-template-component.min.js"></script>
    <script src="https://unpkg.com/aframe-proxy-event-component@2.1.0/dist/aframe-proxy-event-component.min.js"></script>
    <script src="https://unpkg.com/aframe-vr-mode-watcher@1.0.0/dist/aframe-vr-mode-watcher.min.js"></script>

    <!-- Image link template to be reused. -->
    <script id="link" type="text/html">
      <a-entity class="link"
        geometry="primitive: plane; height: 1; width: 1"
        material="shader: flat; src: ${thumb}"
        event-set__mouseenter="scale: 1.2 1.2 1"
        event-set__mouseleave="scale: 1 1 1"
        event-set__click="_target: #image-360; _delay: 300; material.src: ${src}"
        proxy-event="event: click; to: #image-360; as: fade"
        sound="on: click; src: #click-sound"
      >      </a-entity>
    </script>

    <script id="portal" type="text/html">
      <a-entity class="portal"
        event-set__mouseenter="scale: 1.2 1.2 1"
        event-set__mouseleave="scale: 1 1 1"
        event-set__click="_target: #image-360; _delay: 300; material.src: ${src}"
        proxy-event="event: click; to: #image-360; as: fade"
      >      </a-entity>
    </script>

    
    <script id="externalLink" type="text/html">
      <a-entity class="externalLink venue-entity"
        event-set__click="_target: #image-360; _delay: 300; material.src: ${src}"
        proxy-event="event: click; to: #image-360; as: fade"
      >      </a-entity>
    </script>

    <script>
      //var datetime = new Date().toLocaleTimeString();
      document.title = "Welcome to ArtsCity";
    </script>
  </head>
  <body>
    <a-scene 
    start="eltotoggle:camile-click-the-image;texttotoggle:chat-text;delay:3500;
    text:Hello, welcome to ArtsCity - The Arts' Metaverse. My name is Camile, and I am your host today.;
    mousemovetext:Place the ring pointer over a black tag to get more info.;"
>
      <a-assets>
        <audio
          id="click-sound"
          crossorigin="anonymous"
          src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg"
        ></audio>
       <img
          id="360venue01"
          crossorigin="anonymous"
          src="https://res.cloudinary.com/artscity-io/image/upload/v1649111148/spaces_du0swv.jpg"
        />
        <img
          id="360venue02"
          crossorigin="anonymous"
          src="https://res.cloudinary.com/artscity-io/image/upload/v1649111116/apartment_td4nsl.jpg"
        />
        <img
          id="360museum01"
          crossorigin="anonymous"
          src="https://res.cloudinary.com/artscity-io/image/upload/v1649111760/Equirectangular_bild_format_dxwf9x.jpg"
        />
        <img
          id="sechelt"
          crossorigin="anonymous"
          src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg"
        />
        <img
          id="camile"
          crossorigin="anonymous"
          src="https://res.cloudinary.com/artscity-io/image/upload/v1648323231/camile_esy7cy.jpg"
        />
        <img
          id="artscity"
          crossorigin="anonymous"
          src="https://res.cloudinary.com/artscity-io/image/upload/v1648322641/artscity_daytcq.jpg"
        />
      </a-assets>


      <!-- venue walls. -->
      <img
          id="venue-wall-01"
          crossorigin="anonymous"
          src="https://lh3.googleusercontent.com/oEHKzENSwJvSnkx2ohs4YCeZQWsZo8aH06_zxMnKpZVY8M3OFJycGOcucix0Ft_8S7bOfHIzv5tHZqR4i0pR_TRpwKw4hVU7pFVx=s0"
          />
      </a-assets>

      <img
        id="venue-wall-02"
        crossorigin="anonymous"
        src="https://lh3.googleusercontent.com/Ic0AIMJ6jIUbqNvvDo_dBFuXfgAgnovTpvV0mP5lTOHWdNzw-hSeRIFBAhlL5TH27ex7aJuxJUt52vkfXPNAevRKJsKatquYfsyO6A=s0"
      />
     </a-assets>
        
  <!--external links-->  

  <!--venue wall 01 (closer to the window)-->   
  <a-entity 
    class="flex-entity venue-entity"
    visible="false"
    position="-0.25 -0.8 -4">
    <a-image 
      src="#venue-wall-01"  
      position="9.22624 1.1 1.77127" 
      rotation="-3.15 -75.50149942275425 1.61"
      scale="3 3 1"
      class="externalLink venue-entity flex-entity"
      event-set__mouseenter="scale: 4.0 4.0 1"
      event-set__mouseleave="scale: 3 3 1"
      nftinfo="title:Bear #1048;marketplace:OpenSea;price:listed for 0.1 ETH;eltotoggle:camile-click-the-image;texttotoggle:chat-text;url:https://opensea.io/assets/0x2d097c1535988216499722df726617a3607b0f08/1048?ref=0x7c931021D05bD679139c9Ce35A3BD17E669f100d"


      >
    </a-image>   
  </a-entity>

  <!--venue wall 02-->   
  <a-entity 
    class="flex-entity venue-entity"
    visible="false"
    position="1.82414 0.49782 -8" 
    rotation="-6.339778003122559 2.868226722424901 0.12948846169956604" 
    class="venue-entity"
  >
    <a-image 
      src="#venue-wall-02" 
      scale="2.72098 2.5567 1" 
      rotation="0.03781521447863433 -1.4501561794761135 -1.2501939089754561"
      class="externalLink venue-entity flex-entity "
      event-set__mouseenter="scale: 4.0 4.0 1"
      event-set__mouseleave="scale: 3 3 1"
      nftinfo="title:Baby Apepunk Club #109;marketplace:OpenSea;price:not listed;eltotoggle:camile-click-the-image;texttotoggle:chat-text;url:https://opensea.io/assets/matic/0x734ad92b06967533cdb8893db60266c527919022/109?ref=0x7c931021D05bD679139c9Ce35A3BD17E669f100d"

    >
    </a-image>
  </a-entity>


      <!-- sky. -->
      <a-sky
        id="image-360"
        radius="10"
        src="#artscity"
        rotation="0 60 0"
        animation__fade="property: components.material.material.color; type: color; from: #FFF; to: #000; dur: 300; startEvents: fade"
        animation__fadeback="property: components.material.material.color; type: color; from: #000; to: #FFF; dur: 300; startEvents: animationcomplete__fade"
      ></a-sky>



      <!-- museum banner-->
      <a-entity
        class="city-entity flex-entity"
        id="museum"
        layout="margin: 0"
        position="-1 0.25 -9"
        visible="true"
        rotation="0 8 0"
        scale="1.5 1.5"
      >
        <a-plane
          color="#000"
          height="0.75"
          width="2"
          position="10 0 -10"
        ></a-plane>
        <a-entity
          text="value: The CryptoArt Museum; color: #fff; align: center; width:3;"
          position="5 0.0 5"
          layout="margin: 10"
          width="5"
        ></a-entity>
      </a-entity>

      <!-- venue banner -->
      <a-entity
              class="city-entity flex-entity clickable"

        id="venue"
        layout="margin: 0"
        position="-3.9 -1.5 -3.4"
        visible="true"
        rotation="0 65 0"
        togglescenes="show:venue-entity;hide:flex-entity"
        chatinfo="text:I use my apartment to showcase NFTs from my wallet. Just click on the black tag to take a look.;eltotoggle:camile-click-the-image;texttotoggle:chat-text;"
      >

      
        <a-plane
        color="#000"
        height="0.75"
        width="1.5"
        position="10 0 -10"
        class="portal clickable city-entity flex-entity "
        data-src="#360venue02"
        event-set__mouseenter="scale: 1.2 1.2 1"
        event-set__mouseleave="scale: 1 1 1"
        event-set__click="_target: #image-360; _delay: 300; material.src: #360venue01;"
        proxy-event="event: click; to: #image-360; as: fade"
        sound="on: click; src: #click-sound"
              

        ></a-plane>

        <a-entity
          text="value: Camile's Venue; color: #fff; align: center; width:3;"
          position="0 0 0"
          layout="margin: 10"
          width="4"
        ></a-entity>

      </a-entity>

      <!-- gallery banner-->
      <a-entity
        class="city-entity flex-entity"
        id="gallery"
        layout="margin: 0"
        position="-1.12 -1.48 7.244"
        visible="true"
        rotation="0 165 0"
      >
        <a-plane
          color="#000"
          height="0.75"
          width="2"
          position="10 0 -10"
        ></a-plane>
        <a-entity
          text="value: Metamodern Art Gallery; color: #fff; align: center; width:4;"
          position="5 0.0 5"
          layout="margin: 10"
          width="6"
        ></a-entity>
      </a-entity>


      </a-entity>


      <!-- back to the city banner -->
      <a-entity class="venue-entity flex-entity"           
                togglescenes="show:city-entity;hide:flex-entity"
                id="back-to-the-city"
                layout="margin: 0; angle: NaN; columns: 2" 
                position="4.87125 2.26612 6.41826" 
                visible="" 
                rotation="-0.599886811501972 -166.68029809709805 2.531900496683108" 
                scale="1.5 1.5 1">
        <a-plane 
                  class="flex-entity venue-entity"
                  data-src="#artscity"
                  event-set__mouseenter="scale: 1.2 1.2 1"
                  event-set__mouseleave="scale: 1 1 1"
                  event-set__click="_target: #image-360; _delay: 300; material.src: #artscity;"
                  proxy-event="event: click; to: #image-360; as: fade"
                  sound="on: click; src: #click-sound"
                  color="#000" height="0.75" width="2" position="" material="" geometry="" rotation="">
        </a-plane>
        <a-entity 
          text="value: Back to the city; color: #fff; align: center; width: 3" 
          position="" 
          layout="margin: 10; angle: NaN; columns: 0" 
          width="5"
        >
        </a-entity>
      </a-entity>


      <!-- camile chat city-->
      <a-entity position="-.25 .8 -4"
      class="city-entity flex-entity"
      id="camile-chat-city"
      visible="false">
        <a-plane
          color="#CCC"
          height="0.75"
          width="2.5"
          position=".25 0 2.5"
        ></a-plane>
        <a-entity
          template="src: #link"
          data-src="#artscity"
          data-thumb="#camile"
          scale="0.5 0.5"
          position="-.65 0 2.6"
        ></a-entity>
        <a-entity
          text="value: Hello, welcome to ArtsCity - The Arts' Metaverse. My name is Camile, and I am your host today.  Please feel free to walk around.; color: #000"
          position=".45 .015 2.6"
          scale="1.5 1.5 1.5"
        >
        </a-entity>
      </a-entity>

      <!-- Camera + cursor. --dutration: 9000-from: 0 5.5 5; to: 0 2.6 -4; -->
      <a-entity
        id="camera-rig"
        animation="property: position; from: 0 8 0; to: 0 0.0 0;  dur: 6001; easing: linear; loop: false"
      >
        
        <a-entity id="camera" camera look-controls  position-listener rotation-listener>
                      <!--raycaster=objects: .portal, .externalLink-->            

          <a-cursor
            id="cursor"
            animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
            animation__fusing="property: fusing; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
            event-set__mouseenter="_event: mouseenter; color: springgreen"
            event-set__mouseleave="_event: mouseleave; color: orange"
            material="color: orange; shader: flat"
            raycaster="objects: .clickable"
            geometry="primitive: ring; radiusInner: 0.025; radiusOuter: 0.0375;"

          ></a-cursor>
           <!-- camile click the image-->
      <a-entity 
        position="-0.21436 -.8 -4"     
        class="flex-entity venue-entity"
        id="camile-click-the-image" 
        visible="false"
>
        <a-plane color="#CCC" height="0.65" width="2.5" position="0.25 0 2.5" material="" geometry=""></a-plane>
        <a-entity template="src: #link" data-src="#360venue02" data-thumb="#camile" scale="0.5 0.5 1" position="-0.65 0.05 2.6">
        <a-entity class="link" geometry="primitive: plane" material="shader: flat; src: [object HTMLImageElement]" event-set__mouseenter="[object Object]" event-set__mouseleave="[object Object]" event-set__click="[object Object]" proxy-event="event: click; to: #image-360; as: fade" sound="on: click; src: https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg">      </a-entity></a-entity>
        <a-entity id="chat-text" text="value:Hello, welcome to ArtsCity - The Arts' Metaverse. My name is Camile, and I am your host today.  Hover the black tags with the ring pointer to get more info, and click them to enter the places. Please feel free to walk around.; color: #000" position="0.45 0.130 2.6" scale="1.5 1.5 1.5">
        </a-entity>
      </a-entity>
        </a-entity>
      </a-entity>
    </a-scene>
  </body>
  <script>
      AFRAME.registerComponent('togglescenes', {
        schema: {
          show: {default:'default'},
          hide: {default:'default'}
        },        
        init: function () {
          var data = this.data;
          var el = this.el; 
          var classToShow = document.getElementsByClassName(data.show);
          var classToHide = document.getElementsByClassName(data.hide);

           el.addEventListener('click', function () {
            for (var i=0; i < classToHide.length; i++) {
            classToHide[i].setAttribute("visible", false);
            classToHide[i].classList.remove("clickable");
         
            }
            for (var i=0; i < classToShow.length; i++) {
            classToShow[i].setAttribute("visible", true);
            classToShow[i].classList.add("clickable");

            }
      
          });        
         
        }
      });

      AFRAME.registerComponent('nftinfo', {
        schema: {
          price: {default:'not listed'},
          marketplace: {default:'default'},
          eltotoggle:{default:'default'},
          url:{default:'default'},
          texttotoggle:{default:'default'},
          title:{default:'default'},
        },        
        init: function () {
          var data = this.data;
          var el = this.el;
          var eltotoggle = document.getElementById(data.eltotoggle);
          var texttotoggle = document.getElementById(data.texttotoggle);
          var text = 'value: '+data.title+ ': this digital asset is ';
          text += data.price + '.';
          text +='You can see it on '
          text += data.marketplace+' by clicking the image.'
          text += data.marketplace+" Listed assets' early buyers are going to be whitelisted for future projects.";

           el.addEventListener('mouseenter', function () {
              eltotoggle.setAttribute("visible", false);
              texttotoggle.setAttribute("text", text);
              eltotoggle.setAttribute("visible", true);
         });   
         
          el.addEventListener('mouseleave', function () {
             eltotoggle.setAttribute("visible", false);

         });   

             el.addEventListener('click', function () {
             window.open(data.url, '_blank');
         });         
        
        }
      });
 AFRAME.registerComponent('chatinfo', {
        schema: {
          text: {default:'default'},
          texttotoggle:{default:'default'},
          eltotoggle:{default:'default'},
          delay:{default:1000},
        },        
        init: function () {
          var data = this.data;
          var el = this.el;
          var eltotoggle = document.getElementById(data.eltotoggle);
          var texttotoggle = document.getElementById(data.texttotoggle);
          var text = 'value: '+data.text;
          var delay = data.delay;

           el.addEventListener('mouseenter', function () {
              eltotoggle.setAttribute("visible", false);
              texttotoggle.setAttribute("text", text);
              setTimeout(() => { eltotoggle.setAttribute("visible", true);}, delay);

         });   
         
          el.addEventListener('mouseleave', function () {
             eltotoggle.setAttribute("visible", false);

         });   
                  
        }
      });

 AFRAME.registerComponent('start', {
        schema: {
          text: {default:'default'},
          mousemovetext: {default:'default'},
          texttotoggle:{default:'default'},
          eltotoggle:{default:'default'},
          delay:{default:1000},
        },        
        init: function () {
          var data = this.data;
          var el = this.el;
          var eltotoggle = document.getElementById(data.eltotoggle);
          var texttotoggle = document.getElementById(data.texttotoggle);
          var text = 'value: '+data.text;
          var mousemovetext = 'value: '+data.mousemovetext;
          var delay = data.delay;
          var started = el.getAttribute('started');


          // el.addEventListener('mouseenter', function () {
              eltotoggle.setAttribute("visible", false);
              texttotoggle.setAttribute("text", text);
              setTimeout(() => { eltotoggle.setAttribute("visible", true);}, delay);

         //});   
        
          setTimeout(() => { 
                    eltotoggle.setAttribute("visible", false);

                    document.getElementById('camera').addEventListener('rotationChanged', e => {
                    
                      started = el.getAttribute('started');

                      if (started) {
            console.log("started");

          }
          else
          {
                        console.log("not started");

         
                           texttotoggle.setAttribute("text", mousemovetext);
                    setTimeout(() => {eltotoggle.setAttribute("visible", true); 
                            var markedasstarted = el.setAttribute("started", true);
}, 1000);
                      }
                    //console.log('New rotation:', e.detail);
                

                  });

          }, delay+5000);




                           
        }
      });


    AFRAME.registerComponent('rotation-listener', {
  tick() {
    const newValue = this.el.getAttribute('rotation');
    const stringCoords = AFRAME.utils.coordinates.stringify(newValue);
    if (this.lastValue !== stringCoords) {
      this.el.emit('rotationChanged', newValue);
      this.lastValue = stringCoords;
    }
  },
});

AFRAME.registerComponent('position-listener', {
  tick() {
    const newValue = this.el.getAttribute('position');
    const stringCoords = AFRAME.utils.coordinates.stringify(newValue);
    if (this.lastValue !== stringCoords) {
      this.el.emit('positionChanged', newValue);
      this.lastValue = stringCoords;
    }
  },
});

    AFRAME.registerComponent("scenelistener", {
      init: function () {
        let vrcam = document.querySelector("#cam-vr");
        let dcam = document.querySelector("#cam-desktop");
        let cursor = document.querySelector("[cursor]");
        //console.clear(); /*from   ww  w.de mo  2  s .c  o m*/
        //console.log("init");
        //console.log("vrcam:");
        //console.log(vrcam);
        //console.log("dcam:");
        //console.log(dcam);
        //console.log("cursor:");
        //console.log(cursor);
        this.el.sceneEl.addEventListener("enter-vr", function () {
          cursor.setAttribute("visible", true);
          dcam.setAttribute("camera", "active", false);
          vrcam.setAttribute("camera", "active", true);
        });
        this.el.sceneEl.addEventListener("exit-vr", function () {
          cursor.setAttribute("visible", false);
          dcam.setAttribute("camera", "active", true);
          vrcam.setAttribute("camera", "active", false);
        });
      },
    });
  </script>
</html>
